
@{
    ViewData["Title"] = "Index";
}
@section Styles{
    <link href="//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
}

<div class="container">
    <h2>Products</h2>
    <div class="panel-group">
        <div class="panel panel-primary">
            <div class="panel-heading">
                Product List
            </div>
            <div class="panel-body">
                <button id="btnAddProductPopUp" style="float: right;" class="btn btn-primary">Add Product</button>
                <table id="tblProduct">
                    <thead>
                        <tr>
                            <td>
                                Id
                            </td>
                            <td>
                                Name
                            </td>
                            <td>
                                Price
                            </td>
                            <td>
                                Action
                            </td>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- begin::Modal -->
    <div class="modal fade" id="divModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div id="myModalContent">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- end::Modal -->

@section scripts{
    <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function () {
            bindProductList();
        });

        $(document).on("click", "#btnClose", function () {
            $('#divModal').modal('hide');
        });

        $(document).on("click", "#btnProduct", function () {
            $.validator.unobtrusive.parse($('#formProduct'));
            if ($("#formProduct").valid()) {
                $.post("/Product/AddUpdateProduct", $("#formProduct").serialize()).done(function (data) {
                    if (data.Status === true) {
                        $("#divModal").modal('hide');
                        bindProductList();
                    }
                    myFunction(data.Message);
                });
            } else {
                return;
            }
        });

        $(document).on("click", "#btnAddProductPopUp", function () {
            $("#myModalContent").html("");
            $("#myModalContent").load("@Url.Action("AddUpdateProduct", "Product")?productId=" + 0);
            $("#divModal").modal('show');
        });



        function bindProductList() {
            if ($.fn.DataTable.isDataTable("#tblProduct")) {
                $("#tblProduct").dataTable().fnDestroy();
            }
            $("#tblProduct").DataTable({
                "processing": true, // for show progress bar
                "serverSide": true, // for process server side
                "filter": true, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "ajax": {
                    "url": "/Product/GetProductList",
                    "type": "POST",
                    "datatype": "json"
                },
                "columnDefs":
                    [{
                        "targets": [0],
                        "visible": false,
                        "searchable": false
                    }],
                "columns": [
                    { "data": "ProductId", "name": "ProductId", "autoWidth": true },
                    { "data": "Name", "name": "Name", "Name": true },
                    { "data": "Price", "name": "Price", "autoWidth": true },
                    {
                        data: null, render: function (data, type, row) {
                            return "<a href='#' class='btn btn-primary' onclick=Edit('" + row.ProductId + "'); >Edit</a>" +
                                "<a href='#' class='btn btn-danger' onclick=Delete('" + row.ProductId + "'); >Delete</a>";
                        }
                    }
                ]
            });

        }

        function Edit(id) {
            $("#myModalContent").html("");
            $("#myModalContent").load("@Url.Action("AddUpdateProduct", "Product")?productId=" + id);
            $("#divModal").modal('show');
        }

        function Delete(id) {
             $.ajax({
                 url: "@Url.Action("DeleteProduct", "Product")?id=" + id,
                 dataType: "json",
                 type: 'Get',
                 success: function (data) {
                     if (data.Status === true) {
                         bindProductList();
                     }
                     myFunction(data.Message);
                 }
             });
        }


    </script>
}
